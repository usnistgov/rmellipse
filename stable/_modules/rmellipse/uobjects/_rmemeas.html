<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>rmellipse.uobjects._rmemeas &#8212; Rocky Mountain Ellipse 0.3.5.dev4+ga287edda7 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/nature.css?v=0f882399" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <script src="../../../_static/documentation_options.js?v=888cb622"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
  <script src="https://code.jquery.com/jquery-1.12.4.min.js" type="text/javascript"></script>
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>


<script type="text/javascript" src="https://pages.nist.gov/leaveNotice/js/jquery.leaveNotice-nist.min.js"></script>
<script>
$(document).ready(function(){
  // Mark external (non-nist.gov) A tags with class "external"
  //If the adress start with https and ends with nist.gov
  var re_nist = new RegExp('^https?:\/\/((^\/)*\.)*nist\\.gov(\/|$)');
  //Regex to find address that start with https
  var re_absolute_address = new RegExp('^((https?:)?\/\/)');
  $("a").each(function(){
    var url=$(this).attr('href');
    if(re_nist.test(url) || !re_absolute_address.test(url)){
      $(this).addClass('local');
    }else{
      //This a href appears to be external, so tag it
      $(this).addClass('external');
    }
  });
  // Add leaveNotice to external A elements
  $('a.external').leaveNotice();
});
</script>
<link rel="stylesheet" type="text/css" href="https://pages.nist.gov/leaveNotice/css/jquery.leaveNotice.css" />


  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Rocky Mountain Ellipse 0.3.5.dev4+ga287edda7 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">rmellipse.uobjects._rmemeas</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            


  <h1>Source code for rmellipse.uobjects._rmemeas</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for creating and interacting with RMEMeas objects.</span>

<span class="sd">RMEMeas objects are the </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># These need to be imported this way to delay access</span>
<span class="c1"># to the underlying classes to avoid a circular import error</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rmellipse.uobjects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">uobj</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rmellipse.propagators</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">propagators</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">rmellipse.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">GroupSaveable</span><span class="p">,</span> <span class="n">load_object</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>  <span class="c1"># because math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os.path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<span class="c1"># from functools import wraps</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rmellipse.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">MUFMeasParser</span>
<span class="c1"># from rmellipse.utils import console_graphics</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">warnings</span><span class="w"> </span><span class="kn">import</span> <span class="n">warn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequence</span>

<span class="c1"># umechdim = &#39;umechs&#39;</span>

<span class="n">_uncoutput</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;RMEUncTuple&#39;</span><span class="p">,</span> <span class="s1">&#39;cov mc&#39;</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RMEMeas&#39;</span><span class="p">,</span> <span class="s1">&#39;RMEMeasFormatError&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="RMEMeasFormatError">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeasFormatError">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RMEMeasFormatError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error in formatting of data inside RMEMeas</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Exception : _type_</span>
<span class="sd">        _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_angle_diff</span><span class="p">(</span><span class="n">phase1</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">phase2</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the minimum difference between two angles.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    angle1 : xr.DataArray</span>
<span class="sd">        Phase array 1 in radians or deg.</span>
<span class="sd">    angle2 : xr.DataArray</span>
<span class="sd">        Phase array 1 in radians or deg.</span>
<span class="sd">    deg: bool, optional</span>
<span class="sd">        If true, calculates in degrees</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : xr.DataArray</span>
<span class="sd">        Phase difference between two angles.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">const</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">if</span> <span class="n">deg</span><span class="p">:</span>
        <span class="n">const</span> <span class="o">=</span> <span class="mi">180</span>

    <span class="n">diff</span> <span class="o">=</span> <span class="p">((</span><span class="n">phase1</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">phase2</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="n">const</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">const</span><span class="p">)</span> <span class="o">-</span> <span class="n">const</span>

    <span class="c1"># return the minimum possible phase difference</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">phase1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">out</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">diff</span>
    <span class="k">return</span> <span class="n">out</span>


<div class="viewcode-block" id="RMEMeas">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RMEMeas</span><span class="p">(</span><span class="n">uobj</span><span class="o">.</span><span class="n">UObj</span><span class="p">,</span> <span class="n">GroupSaveable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class that stores monte-carlo and linear sensitivity uncertainty information.</span>

<span class="sd">    Used with the rmellipse.RMEProp propagator.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RMEMeas&#39;</span><span class="p">,</span>
                 <span class="n">cov</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">mc</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">covdofs</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">covcats</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a RMEMeas object.</span>

<span class="sd">        Please refer to xarray&#39;s documentation for information about how to </span>
<span class="sd">        use DataArrays, and how to define coordinates and dimensions.</span>

<span class="sd">        If covdofs is not provided, distributions of linear uncertainty</span>
<span class="sd">        mechanisms are assumed to have infinite degrees of freedom (Gaussian).</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            Name of RMEMeas object. The default is &#39;RMEMeas&#39;.</span>
<span class="sd">        cov : xr.DataArray, optional</span>
<span class="sd">            Covariance data for linear sensitivity analysis. Copies of data set</span>
<span class="sd">            are stored along the first dimension (axis 0) of the DataArray, where</span>
<span class="sd">            the first index of axis 0 is the nominal data set, and the rest of</span>
<span class="sd">            the indexes along that dimension are perturbed by one standard deviation</span>
<span class="sd">            (i.e. 1 standard uncertainty). </span>

<span class="sd">            The first dimension must be called &#39;umech_id&#39;, and the</span>
<span class="sd">            first label of the &#39;parameter_dimensions&#39; coordinate must be</span>
<span class="sd">            &#39;nominal&#39;. The remaining labels for the &#39;umech_id&#39;</span>
<span class="sd">            coordinate should be strings corresponding the the uncertainty</span>
<span class="sd">            mechanism. The default is None.</span>
<span class="sd">        mc : xr.DataArray, optional</span>
<span class="sd">            Montecarlo data for linear sensitivity analysis. Samples of the data</span>
<span class="sd">            sets distribution are stored along the first dimension (axis 0) of the DataArray, where</span>
<span class="sd">            the first index of axis 0 is the nominal data set, and the rest of</span>
<span class="sd">            the indexes are samples of the distribution.</span>

<span class="sd">            The first dimension must be called &#39;umech_id&#39;, and the</span>
<span class="sd">            first labels of the &#39;parameter_dimensions&#39; must start at 0 and</span>
<span class="sd">            count up by 1 (i,e typical integer based indexing).</span>
<span class="sd">            The default is None.</span>
<span class="sd">        covdofs : xr.DataArray, optional</span>
<span class="sd">            DataArray that stores the degrees of freedom for each linear</span>
<span class="sd">            uncertainty mechanism in cov. It should be a 1 dimensional</span>
<span class="sd">            DataArray with the dimension called &#39;umech_id&#39; and</span>
<span class="sd">            the coordinate set should be identical to the</span>
<span class="sd">            &#39;umech_id&#39; coordinate in cov. If covariance data</span>
<span class="sd">            is provided and covdofs is not, one will be created that assumes </span>
<span class="sd">            all linear mechanisms have infinite degrees of freedom (i.e.</span>
<span class="sd">            gaussian distributions). The default is None.</span>
<span class="sd">        covcats : xr.DataArray, optional</span>
<span class="sd">            DataArray that stores the categories of each uncertainty mechanism.</span>
<span class="sd">            Expected to be have dimensions (&#39;umech_id&#39;,&#39;categories&#39;),</span>
<span class="sd">            If not provided, all umech_id are assigned a &#39;Type&#39; category</span>
<span class="sd">            of &#39;B&#39;. If a mechanism doesn&#39;t have a category, it should be an empty</span>
<span class="sd">            string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># init as a RMEMeas object</span>
        <span class="n">uobj</span><span class="o">.</span><span class="n">UObj</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># initialize as a group saveable thing</span>
        <span class="n">GroupSaveable</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;is_big_object&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># assumes first dimension are uncertainty mechanisms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>  <span class="c1"># name of the mechanism</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cov</span> <span class="o">=</span> <span class="n">cov</span>  <span class="c1"># name of the covariance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">=</span> <span class="n">mc</span>  <span class="c1"># name of the montecarlo data</span>

        <span class="c1"># if covariance data is provided but not DOF information is provide</span>
        <span class="c1"># default to inf degrees of freedom</span>
        <span class="k">if</span> <span class="n">cov</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">covdofs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">covdofs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">umech_id</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">covdofs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
                <span class="n">covdofs</span><span class="p">,</span>
                <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;umech_id&#39;</span><span class="p">),</span>
                <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">umech_id</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span> <span class="o">=</span> <span class="n">covdofs</span>

        <span class="c1"># default to assigning type b category to anything uncategorized</span>
        <span class="k">if</span> <span class="n">cov</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">covcats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;umech_id&#39;</span><span class="p">,</span> <span class="s1">&#39;categories&#39;</span><span class="p">)</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">umech_id</span><span class="p">,</span>
                      <span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="n">cats</span><span class="p">}</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">umech_id</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="n">values</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span>
            <span class="n">covcats</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span> <span class="o">=</span> <span class="n">covcats</span>

        <span class="c1"># enforce rule on name of uncertainty/montecarlo dimensions</span>
        <span class="c1"># self._validate_conventions()</span>

        <span class="c1"># add attributes as children so they get saved into hdf5 formats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s1">&#39;cov&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">,</span>
            <span class="n">is_big_object</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s1">&#39;mc&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">,</span>
            <span class="n">is_big_object</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s1">&#39;covdofs&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s1">&#39;covcats&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">covcats</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">covdofs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;xr.DataArray: The degrees of freedom on linear mechanisms.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="s1">&#39;covdofs&#39;</span><span class="p">]</span>

    <span class="nd">@covdofs</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">covdofs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the degrees of freedom on linear mechanisms.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="s1">&#39;covdofs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataarray</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">covcats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;xr.DataArray: String metadata for linear uncertainty mechanisms.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="s1">&#39;covcats&#39;</span><span class="p">]</span>

    <span class="nd">@covcats</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">covcats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the categories of linear mechanisms.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="s1">&#39;covcats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dictionary</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;xr.DataArray: samples of Monte-Carlo distributions.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="s1">&#39;mc&#39;</span><span class="p">]</span>

    <span class="nd">@mc</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the montecarlo distributions.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="s1">&#39;mc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataarray</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cov</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;xr.DataArray: Linear uncertainty mechanisms.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="s1">&#39;cov&#39;</span><span class="p">]</span>

    <span class="nd">@cov</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cov</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the linear uncertainty mechanisms.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="s1">&#39;cov&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataarray</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;str: The name of the object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

    <span class="nd">@name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the name of the RMEMeas object.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the string representation of the RMEMeas object.&quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; with nominal: </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">msg</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the representation of the RMEMeas object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_if_quacks</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if obj is a duck type of RMEMeas.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;cov&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;mc&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_conventions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that cov and mc follow assumed conventions or organizing data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Exception:</span>
<span class="sd">            If the RMEMeas properties violated a required convention.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check that covdofs has umech_id</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">umech_id</span>
            <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">exec</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RMEMeasFormatError</span><span class="p">(</span><span class="s1">&#39;covdofs doesnt have dimension called umech_id&#39;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exec</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;umech_id&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RMEMeasFormatError</span><span class="p">(</span><span class="s1">&#39;First dimension of a RME meas object cov DataArray MUST be called &quot;umech_id&quot;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;umech_id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;nominal&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RMEMeasFormatError</span><span class="p">(</span><span class="s1">&#39;First label of &quot;umech_id&quot; coordinate dimension MUST be called &quot;nominal&quot;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;umech_id&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RMEMeasFormatError</span><span class="p">(</span><span class="s1">&#39;First dimension of a RMEMeas object mc DataArray MUST be called &quot;umech_id&quot;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;umech_id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RMEMeasFormatError</span><span class="p">(</span><span class="s1">&#39;mc DataArray &quot;umech_id&quot; dim must have an integer coordinate set starting from 0&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">umech_id</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">exec</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RMEMeasFormatError</span><span class="p">(</span><span class="s1">&#39;covcats doesnt have dimension called umech_id&#39;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exec</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;umech_id&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RMEMeasFormatError</span><span class="p">(</span><span class="s1">&#39;First dimension of a RMEMeas object covcats DataArray MUST be called &quot;umech_id&quot;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;umech_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">umech_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">RMEMeasFormatError</span><span class="p">(</span><span class="s1">&#39;covcats DataArray &quot;umech_id&quot; coord must match cov umech_id&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="o">.</span><span class="n">umech_id</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">exec</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RMEMeasFormatError</span><span class="p">(</span><span class="s1">&#39;covdofs doesnt have dimension called umech_id&#39;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exec</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;umech_id&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RMEMeasFormatError</span><span class="p">(</span><span class="s1">&#39;First dimension of a RMEMeas object .covdofs DataArray MUST be called &quot;umech_id&quot;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;umech_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">umech_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">RMEMeasFormatError</span><span class="p">(</span><span class="s1">&#39;.covdofs DataArray &quot;umech_id&quot; coord must match cov umech_id&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="RMEMeas.from_nom">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.from_nom">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_nom</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">nom</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;RMEMeas&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a RMEMeas object with just a nominal dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the object to be created.</span>
<span class="sd">        nom : xr.DataArray</span>
<span class="sd">            Nominal data set.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &#39;RMEMeas&#39;</span>
<span class="sd">            A RMEMeas object with only nominal values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="n">nom</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">({</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;nominal&#39;</span><span class="p">]})</span>
        <span class="k">return</span> <span class="n">RMEMeas</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="n">cov</span><span class="p">)</span></div>


<div class="viewcode-block" id="RMEMeas.from_dist">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.from_dist">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dist</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">nom</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="n">std</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span>
            <span class="n">mechanism_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">samples</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
            <span class="n">categories</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Type&#39;</span><span class="p">:</span> <span class="s1">&#39;B&#39;</span><span class="p">},</span>
            <span class="n">use_sample_mean</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;RMEMeas&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a RMEMeas object from a probability distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the object.</span>
<span class="sd">        nom : float</span>
<span class="sd">            Expected value of the distribution.</span>
<span class="sd">        std : float</span>
<span class="sd">            Standard deviation of the distribution.</span>
<span class="sd">        dist : str, {&#39;gaussian&#39;, &#39;normal&#39;, &#39;uniform&#39;, &#39;rectangular&#39;}</span>
<span class="sd">            Name of the distribution to use. Supports &#39;gaussian&#39; or &#39;uniform&#39;.</span>
<span class="sd">            The default is &#39;gaussian&#39;.</span>
<span class="sd">        mechanism_name : str, optional</span>
<span class="sd">            What to name the linear uncertainty mechanisms associated with the</span>
<span class="sd">            distribution. The default is None.</span>
<span class="sd">        samples : float, optional</span>
<span class="sd">            How many monte-carlo samples to draw from. The default is 100.</span>
<span class="sd">        categories : dict[str], optional</span>
<span class="sd">            What to categorize the linear uncertainty mechanism as</span>
<span class="sd">            Should be {category:value} pairs. The default is {&#39;Type&#39;:&#39;B&#39;}.</span>
<span class="sd">        use_sample_mean_std : bool, optional</span>
<span class="sd">            If true, uses the mean and standard deviation of random samples drawn</span>
<span class="sd">            from the defined distribution for the linear sensitivity analysis and</span>
<span class="sd">            as the nominal and standard uncertainty values. If False, uses the provided nominal and</span>
<span class="sd">            standard deviation of the distribution. The default is True.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Exception</span>
<span class="sd">            Unsupported distribution.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &#39;RMEMeas&#39;</span>
<span class="sd">            RMEMeas based on defined distribution.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># try:</span>
        <span class="c1">#     dummy = nom[0]</span>
        <span class="c1">#     std = nom[0]</span>
        <span class="c1">#     # raise Exception(&#39;Function doesnt currently support arrays as inputs.&#39;)</span>
        <span class="c1"># except TypeError:</span>
        <span class="c1">#      pass</span>
        <span class="n">nom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nom</span><span class="p">)</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">std</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mechanism_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mechanism_name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">dist</span>

        <span class="c1"># make the covariance</span>
        <span class="n">supported</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="s1">&#39;uniform&#39;</span><span class="p">,</span> <span class="s1">&#39;rectangular&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dist</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Distribution not supported.&#39;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">choose_mean_nom</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">std</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">use_sample_mean</span><span class="p">:</span>
                <span class="n">nom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="o">...</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="o">...</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">nom</span><span class="p">,</span> <span class="n">std</span>

        <span class="c1"># make the montecarlo distributions</span>
        <span class="k">if</span> <span class="n">dist</span> <span class="o">==</span> <span class="s1">&#39;gaussian&#39;</span> <span class="ow">or</span> <span class="n">dist</span> <span class="o">==</span> <span class="s1">&#39;normal&#39;</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">nom</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
            <span class="n">nom</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">choose_mean_nom</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>
            <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">nom</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">vals</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;umech_id&#39;</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span>
                <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span>
                <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">samples</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">dist</span> <span class="o">==</span> <span class="s1">&#39;uniform&#39;</span> <span class="ow">or</span> <span class="n">dist</span> <span class="o">==</span> <span class="s1">&#39;rectangular&#39;</span><span class="p">:</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">std</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">12</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">low</span> <span class="o">=</span> <span class="n">nom</span> <span class="o">-</span> <span class="n">diff</span>
            <span class="n">high</span> <span class="o">=</span> <span class="n">nom</span> <span class="o">+</span> <span class="n">diff</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">h</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">high</span><span class="p">,</span> <span class="n">low</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
            <span class="n">nom</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">choose_mean_nom</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>
            <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">nom</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">vals</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;umech_id&#39;</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span>
                <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span>
                <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">samples</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span>
            <span class="p">)</span>

        <span class="n">cov</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nom</span><span class="p">,</span> <span class="n">nom</span> <span class="o">+</span> <span class="n">std</span><span class="p">]),</span>
            <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span>
            <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;nominal&#39;</span><span class="p">,</span> <span class="n">mechanism_name</span><span class="p">]},</span>
        <span class="p">)</span>

        <span class="n">covcats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">categories</span><span class="p">)),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">categories</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">covcats</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mechanism_name</span><span class="p">],</span> <span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">categories</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;umech_id&#39;</span><span class="p">,</span> <span class="s1">&#39;categories&#39;</span><span class="p">)</span>
        <span class="n">covcats</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">covcats</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">)</span>
        <span class="c1"># {name:categories}</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="n">covcats</span><span class="o">=</span><span class="n">covcats</span><span class="p">)</span></div>


<div class="viewcode-block" id="RMEMeas.dict_from_group">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.dict_from_group">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dict_from_group</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                        <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">group_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;RMEMeas&#39;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read any RMEMeas objects saved in an hdf5 group.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : str</span>
<span class="sd">            path to the hdf5 file.</span>
<span class="sd">        group_path : str, optional</span>
<span class="sd">            path to group. The default is None.</span>
<span class="sd">        verbose : bool , optional</span>
<span class="sd">            If True, prints information about attempts to read</span>
<span class="sd">            files. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict[&#39;RMEMeas&#39;]</span>
<span class="sd">            Dictionary where keys are names of the RMEMeas objects and values</span>
<span class="sd">            are the RMEMeas objects themselves.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">group_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">group_path</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">f</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">isRME</span> <span class="o">=</span> <span class="s1">&#39;RMEMeas&#39;</span> <span class="o">==</span> <span class="n">g</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;__class__.__name__&#39;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">isRME</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">isRME</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_h5</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="RMEMeas.from_h5">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.from_h5">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_h5</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                <span class="n">group</span><span class="p">:</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">,</span>
                <span class="n">nominal_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">keep_attrs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;RMEMeas&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a RMEMeas object from HDF5.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        group:</span>
<span class="sd">            HDF5 Group object</span>
<span class="sd">        nominal_only: bool, optional</span>
<span class="sd">            If true, will only load the nominal value of the data set. Saves</span>
<span class="sd">            time and memory if you don&#39;t need that data.</span>
<span class="sd">        keep_attrs: bool, optional</span>
<span class="sd">            If true, copies over all metadata in attrs. Otherwise, only</span>
<span class="sd">            keeps metadata required for class instantiation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        RMEMeas</span>
<span class="sd">            RMEMeas object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;__class__.__name__&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">class_name</span> <span class="o">==</span> <span class="s1">&#39;RMEMeas&#39;</span><span class="p">:</span>
            <span class="n">umech_dim</span> <span class="o">=</span> <span class="s1">&#39;umech_id&#39;</span>
        <span class="k">elif</span> <span class="n">class_name</span> <span class="o">==</span> <span class="s1">&#39;MUFmeas&#39;</span><span class="p">:</span>
            <span class="n">umech_dim</span> <span class="o">=</span> <span class="s1">&#39;parameter_locations&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;group &#39;</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="s1">&#39; isnt RMEMeas object&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">nominal_only</span><span class="p">:</span>
            <span class="n">cov</span> <span class="o">=</span> <span class="n">load_object</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;cov&#39;</span><span class="p">],</span> <span class="n">load_big_objects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="n">load_object</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;mc&#39;</span><span class="p">],</span> <span class="n">load_big_objects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">covdofs</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">covcats</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">covdofs</span> <span class="o">=</span> <span class="n">load_object</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;covdofs&#39;</span><span class="p">],</span> <span class="n">load_big_objects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">covcats</span> <span class="o">=</span> <span class="n">load_object</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;covcats&#39;</span><span class="p">],</span> <span class="n">load_big_objects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no covdofs/covcats. Possibly trying to read an earlier version of format&#39;</span><span class="p">)</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">things</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cov&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;mc&#39;</span><span class="p">:</span> <span class="p">[]}</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">things</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">data_set</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">data_set</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;__class__.__name__&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;NoneType&#39;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">data_set</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;__class__.__name__&#39;</span><span class="p">])</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_set</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][[</span><span class="mi">0</span><span class="p">],</span> <span class="o">...</span><span class="p">])</span>

                    <span class="n">dims</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">getting_dims</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">while</span> <span class="n">getting_dims</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_set</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
                            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="n">getting_dims</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">coords</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">k2</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">:</span>
                        <span class="n">coords</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_set</span><span class="p">[</span><span class="n">k2</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">):</span>
                            <span class="n">coords</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
                    <span class="n">coords</span><span class="p">[</span><span class="n">umech_dim</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="n">umech_dim</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">thing</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">thing</span><span class="o">.</span><span class="n">dfm</span><span class="o">.</span><span class="n">dataformat</span> <span class="o">=</span> <span class="n">data_set</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dataformat&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="n">things</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">thing</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">things</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">cov</span> <span class="o">=</span> <span class="n">things</span><span class="p">[</span><span class="s1">&#39;cov&#39;</span><span class="p">]</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="n">things</span><span class="p">[</span><span class="s1">&#39;mc&#39;</span><span class="p">]</span>
            <span class="n">covcats</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">covdofs</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

        <span class="c1"># assign names to support old datasets</span>
        <span class="k">if</span> <span class="n">cov</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cov</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;parameter_locations&#39;</span><span class="p">:</span>
            <span class="n">cov</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;parameter_locations&#39;</span><span class="p">:</span> <span class="s1">&#39;umech_id&#39;</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">mc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mc</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;parameter_locations&#39;</span><span class="p">:</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;parameter_locations&#39;</span><span class="p">:</span> <span class="s1">&#39;umech_id&#39;</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">covdofs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">covdofs</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;parameter_locations&#39;</span><span class="p">:</span>
            <span class="n">covdofs</span> <span class="o">=</span> <span class="n">covdofs</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;parameter_locations&#39;</span><span class="p">:</span> <span class="s1">&#39;umech_id&#39;</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">covcats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">covcats</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;parameter_locations&#39;</span><span class="p">:</span>
            <span class="n">covcats</span> <span class="o">=</span> <span class="n">covcats</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;parameter_locations&#39;</span><span class="p">:</span> <span class="s1">&#39;umech_id&#39;</span><span class="p">})</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="n">cov</span><span class="p">,</span> <span class="n">mc</span><span class="o">=</span><span class="n">mc</span><span class="p">,</span> <span class="n">covdofs</span><span class="o">=</span><span class="n">covdofs</span><span class="p">,</span> <span class="n">covcats</span><span class="o">=</span><span class="n">covcats</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">keep_attrs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">]</span>
        <span class="c1"># rename incase it&#39;s an old one with MUFmeas</span>
        <span class="n">out</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;__class__.__name__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RMEMeas&#39;</span>
        <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="RMEMeas.to_h5">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.to_h5">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_h5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">,</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save to an hdf5 object. Wrapper for the group_saveable method &#39;save&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        group : h5py.Group</span>
<span class="sd">            hdf5 group to save under.</span>
<span class="sd">        override: bool,</span>
<span class="sd">            if True, will delete the group object being saved to if it already</span>
<span class="sd">            exists. Default is false.</span>
<span class="sd">        name:str,</span>
<span class="sd">            If provided will change Name of RMEMeas object prior to saving.</span>
<span class="sd">            Equivalent to calling self.name = name prior to calling save.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">oldname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

            <span class="k">if</span> <span class="n">override</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># if a file already exists raise an error</span>
                    <span class="k">if</span> <span class="s1">&#39;name already exists&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                        <span class="k">del</span> <span class="n">group</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">oldname</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">oldname</span>
            <span class="k">raise</span> <span class="n">e</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span></div>


<div class="viewcode-block" id="RMEMeas.from_xml">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.from_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                 <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">from_csv</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
                 <span class="n">old_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">new_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;RMEMeas&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a legacy xml MUFmeas object (xml .meas format).</span>

<span class="sd">        covcats and covdofs metadata will be loaded as the default values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Path to xml header file.</span>
<span class="sd">        from_csv : callable</span>
<span class="sd">            Read function, takes a path to a copy of the data file and returns</span>
<span class="sd">            an xarray object.</span>
<span class="sd">        old_dir : str, optional</span>
<span class="sd">            Name of old path stored in xml file. Will be swapped with new_dir</span>
<span class="sd">            if provided. Old XML format isn&#39;t portable, and the paths</span>
<span class="sd">            need to be manually swapped when the files are moved around.</span>
<span class="sd">            The default is None.</span>
<span class="sd">        new_dir : str, optional</span>
<span class="sd">            Path string to replace old_dir with. The default is None.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Exception</span>
<span class="sd">            If old_dir/new_dir are not both provided, but one is.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : MUFmeas</span>
<span class="sd">            MUFmeas object from the legacy format.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dummy</span> <span class="o">=</span> <span class="n">MUFMeasParser</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">dummy</span><span class="o">.</span><span class="n">open_data</span><span class="p">(</span>
            <span class="n">from_csv</span><span class="p">,</span>
            <span class="n">old_base_dir</span><span class="o">=</span><span class="n">old_dir</span><span class="p">,</span>
            <span class="n">new_base_dir</span><span class="o">=</span><span class="n">new_dir</span>
        <span class="p">)</span>

        <span class="c1"># put into our format</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="p">[</span><span class="n">dummy</span><span class="o">.</span><span class="n">nominal_data</span><span class="p">]</span> <span class="o">+</span> <span class="n">dummy</span><span class="o">.</span><span class="n">covariance_data</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="p">[</span><span class="n">dummy</span><span class="o">.</span><span class="n">nominal_data</span><span class="p">]</span> <span class="o">+</span> <span class="n">dummy</span><span class="o">.</span><span class="n">montecarlo_data</span>
        <span class="n">umechids</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nominal&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;parameter_location&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dummy</span><span class="o">.</span><span class="n">covariance_dict</span><span class="p">]</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;umech_id&#39;</span><span class="p">)</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="n">umechids</span><span class="p">)</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;umech_id&#39;</span><span class="p">)</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">dummy</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">cov</span><span class="p">,</span>
            <span class="n">mc</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="RMEMeas.to_xml">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.to_xml">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_xml</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">target_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">to_csv</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
            <span class="n">data_extension</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">header_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;.meas&#39;</span><span class="p">,</span>
            <span class="n">header_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save to a the Microwave Uncertainty Framework Format.</span>

<span class="sd">        This does not preserve metadata in covdofs or covcats.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target_directory : str</span>
<span class="sd">            Directory in which to save the support folder which stores all</span>
<span class="sd">            the copies of the data.</span>
<span class="sd">        to_csv : callable</span>
<span class="sd">            Dataformat of the underlying cov-data. Will be inferred if left</span>
<span class="sd">            as None. The default is None.</span>
<span class="sd">        data_extension: str</span>
<span class="sd">            What to save the datafile extensions as (e.g. .s1p, .csv, etc)</span>
<span class="sd">        header_extension : str, optional</span>
<span class="sd">            What to save the xml header file extension as.</span>
<span class="sd">            The default is &#39;.meas&#39;.</span>
<span class="sd">        header_directory : str, optional</span>
<span class="sd">            Location in which to store the header file. If None, defaults</span>
<span class="sd">            to the target_directory. Default is None.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Exception</span>
<span class="sd">            If no dataformat provided and one cannot be inferred.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">header_directory</span><span class="p">:</span>
            <span class="n">header_directory</span> <span class="o">=</span> <span class="n">target_directory</span>

        <span class="n">dummy</span> <span class="o">=</span> <span class="n">MUFMeasParser</span><span class="p">()</span>

        <span class="c1"># create legacy data format lists</span>
        <span class="n">cov_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mc_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cov_data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mc_data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

        <span class="c1"># initialize data inside a dummy legacy object</span>
        <span class="n">dummy</span><span class="o">.</span><span class="n">init_from_data</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">montecarlo_data</span><span class="o">=</span><span class="n">mc_data</span><span class="p">,</span>
            <span class="n">nominal_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="p">,</span>
            <span class="n">covariance_data</span><span class="o">=</span><span class="n">cov_data</span><span class="p">,</span>
            <span class="n">umech_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">umech_id</span>
        <span class="p">)</span>

        <span class="c1"># save data to csv</span>
        <span class="n">dummy</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">target_directory</span><span class="p">,</span>
                        <span class="n">save_fcn</span><span class="o">=</span><span class="n">to_csv</span><span class="p">,</span>
                        <span class="n">file_ext</span><span class="o">=</span><span class="n">data_extension</span><span class="p">)</span>

        <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header_directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">header_extension</span><span class="p">)</span>
        <span class="n">dummy</span><span class="o">.</span><span class="n">save_meas</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span></div>


<div class="viewcode-block" id="RMEMeas.copy">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.copy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;RMEMeas&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a copy of a RMEMeas object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        RMEMeas</span>
<span class="sd">            Copied object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">newmc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newmc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">newname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">RMEMeas</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">newname</span><span class="p">,</span>
            <span class="n">cov</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
            <span class="n">mc</span><span class="o">=</span><span class="n">newmc</span><span class="p">,</span>
            <span class="n">covdofs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
            <span class="n">covcats</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="RMEMeas.cull_cov">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.cull_cov">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cull_cov</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove trivial linear uncertainty mechanisms set by tolerance.</span>

<span class="sd">        Any linear uncertainty mechanisms with a sum of all standard</span>
<span class="sd">        uncertainties &lt; tolerance will be removed from the object.</span>

<span class="sd">        For example if tolerance is 0.1, the nominal is  [0,0,0] and</span>
<span class="sd">        the perturbed data for a mechanisms is [0.0,0.1,-0.2], then the</span>
<span class="sd">        function will evaluate the total standard uncertainty for the mechanism</span>
<span class="sd">        as 0.1 + 0.0 + 0.2 = 0.3, and not remove the mechanism.</span>

<span class="sd">        This function is called by the auto-cull setting in the RME</span>
<span class="sd">        propagator.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tolerance : float, optional</span>
<span class="sd">            Maximum value a sum of standard uncertainties that is deemed</span>
<span class="sd">            trivial, used to determine what mechanisms should be removed.</span>
<span class="sd">            The default is 0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="o">...</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">sums</span> <span class="o">=</span> <span class="n">unc</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unc</span><span class="o">.</span><span class="n">shape</span><span class="p">))))</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">sums</span> <span class="o">&gt;</span> <span class="n">tolerance</span>
        <span class="n">keep1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">umech_id</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">ind</span><span class="p">]}</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="kc">True</span><span class="p">],</span> <span class="n">ind</span><span class="p">)</span>
        <span class="n">keep2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">umech_id</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">ind</span><span class="p">]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">keep2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">keep1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">keep1</span><span class="p">)</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="RMEMeas.make_umechs_unique">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.make_umechs_unique">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_umechs_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">same_uid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make parameter locations unique by adding a uuid4 string to end of each.</span>

<span class="sd">        A uiid4 string is added to the end of each parameter_location string.</span>
<span class="sd">        Useful when reading data from different sources that have the same</span>
<span class="sd">        names of uncertainty files. (E.G, multiple device definitions come</span>
<span class="sd">        from calibration service formats with generic &#39;ua,ub&#39; naming)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        same_uid: bool, optional</span>
<span class="sd">            If true, all parameter locations will have the same uid added</span>
<span class="sd">            to the end. Default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">same_uid</span><span class="p">:</span>
            <span class="n">plocs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">umech_id</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plocs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">umech_id</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="n">plocs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="n">plocs</span><span class="p">)</span>

        <span class="n">plocs2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nominal&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">plocs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="n">plocs2</span><span class="p">)</span></div>


<div class="viewcode-block" id="RMEMeas.add_mc_sample">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.add_mc_sample">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_mc_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a Monte Carlo sample to the distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sample : xr.DataArray</span>
<span class="sd">            Single sample of the probability distribution that represents the</span>
<span class="sd">            data set. Expected to be the same shape, dimensions, and</span>
<span class="sd">            coordinates of the nominal.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;nominal&#39;</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">umech_id</span><span class="p">)</span>
        <span class="n">new_sample</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">({</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ind</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">,</span> <span class="n">new_sample</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;umech_id&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="RMEMeas.add_umech">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.add_umech">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_umech</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                  <span class="n">value</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
                  <span class="n">dof</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
                  <span class="n">category</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Type&#39;</span><span class="p">:</span> <span class="s1">&#39;B&#39;</span><span class="p">},</span>
                  <span class="n">add_uid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a linear mechanisms to covariance data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of new mechanism, must be unique.</span>
<span class="sd">        value : xr.DataArray</span>
<span class="sd">            Array of nominal+1 standard uncertainty of new mechanism.</span>
<span class="sd">            If value has the same size as the nominal data, the function will insert a </span>
<span class="sd">            new dimension at axis zero before concatenating to the covariance data.</span>
<span class="sd">        dof: float,optional</span>
<span class="sd">            Degrees of freedom associated with the uncertainty mechanism.</span>
<span class="sd">            Default is infinite.</span>
<span class="sd">        category: dict,</span>
<span class="sd">            Dictionary of key-value string pairs categorizing the uncertainty</span>
<span class="sd">            mechanisms. E.g. {&#39;Type&#39;:&#39;B&#39;,&#39;Origin&#39;:&#39;Datasheet&#39;}. The default</span>
<span class="sd">            is {&#39;Type&#39;:&#39;B&#39;}.</span>
<span class="sd">        add_uid: bool,</span>
<span class="sd">            If true, adds a uuid4 string to the uncertainty mechanism name</span>
<span class="sd">            to make it unique.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">add_uid</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">umech_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Linear mechanisms name &#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; already exists&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span><span class="o">.</span><span class="n">size</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="o">.</span><span class="n">size</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">({</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">]})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cov</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">,</span> <span class="n">v</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;umech_id&#39;</span><span class="p">)</span>
        <span class="n">dofs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">([</span><span class="n">dof</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;umech_id&#39;</span><span class="p">),</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="p">,</span> <span class="n">dofs</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;umech_id&#39;</span><span class="p">)</span>

        <span class="c1"># add extra row to the category for the new mechanism</span>
        <span class="c1"># if no mechanisms, initialize first row</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;umech_id&#39;</span><span class="p">,</span> <span class="s1">&#39;categories&#39;</span><span class="p">)</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">umech_id</span><span class="p">,</span>
                      <span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="n">cats</span><span class="p">}</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="n">values</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">]})</span>
        <span class="c1"># otherwise, append a new row</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="p">[[</span><span class="mi">0</span><span class="p">],</span> <span class="o">...</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">]})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="p">,</span> <span class="n">new_row</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;umech_id&#39;</span><span class="p">)</span>

        <span class="c1"># assign categories to new row</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">designations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign_categories</span><span class="p">([</span><span class="n">name</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">cats</span><span class="p">,</span> <span class="n">designations</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the nominal values of the RMEMeas object.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Exception</span>
<span class="sd">            if no data is store.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xr.DataArray</span>
<span class="sd">            Nominal values in an xr.DataArray</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="s1">&#39;umech_id&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exec</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RMEMeasFormatError</span><span class="p">(</span><span class="s1">&#39;no umech_id in cov&#39;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exec</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="s1">&#39;umech_id&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exec</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RMEMeasFormatError</span><span class="p">(</span><span class="s1">&#39;no umech_id in mc&#39;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exec</span>
        <span class="k">raise</span> <span class="n">RMEMeasFormatError</span><span class="p">(</span><span class="s1">&#39;Both cov and mc attributes are empty. No nominal data available&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">umech_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the names of uncertainty mechanisms, excluding the nominal.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List</span>
<span class="sd">            List of uncertainty mechanism strings.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">umech_id</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RMEMeasFormatError</span><span class="p">(</span><span class="s1">&#39;umech_id dim not present&#39;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

        <span class="k">return</span> <span class="n">out</span>

<div class="viewcode-block" id="RMEMeas.confint">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.confint">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">confint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">deg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the lower, upper confidence intervals for a fractional percent confidence.</span>

<span class="sd">        Confidence intervals are generate using the linear sensitivity analysis</span>
<span class="sd">        data (.cov) using a student-t distribution with means of .nominal, and </span>
<span class="sd">        a scale of 1 standard uncertainty.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        percent : float</span>
<span class="sd">            Percent confidence to calculate intervals on, centered about the</span>
<span class="sd">            nominal. For example, a value of 0.5 will calculate intervals such</span>
<span class="sd">            that 0.25 of samples are between the mean and the lower, and 0.25</span>
<span class="sd">            of expected samples are between the mean and the upper.</span>
<span class="sd">        deg : bool, optional</span>
<span class="sd">            If you are calculated confidence intervals on degrees.</span>
<span class="sd">            The default is False.</span>
<span class="sd">        rad : bool, optional</span>
<span class="sd">            If you are calculating confidence intervals on radians.</span>
<span class="sd">            The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lower : xr.DataArray</span>
<span class="sd">            Lower bounds on the confidence interval.</span>
<span class="sd">        upper : xr.DataArray</span>
<span class="sd">            Upper bounds on the confidence interval.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">t</span> <span class="k">as</span> <span class="n">student_t</span>
        <span class="k">if</span> <span class="n">deg</span> <span class="ow">and</span> <span class="n">rad</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;pick deg or rad&#39;</span><span class="p">)</span>
        <span class="n">stdunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdunc</span><span class="p">(</span><span class="n">deg</span><span class="o">=</span><span class="n">deg</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="n">rad</span><span class="p">)</span>
        <span class="n">dof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dof</span><span class="p">(</span><span class="n">deg</span><span class="o">=</span><span class="n">deg</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="n">rad</span><span class="p">)</span>
        <span class="n">lower_p</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">percent</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">upper_p</span> <span class="o">=</span> <span class="n">percent</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">percent</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">upper</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">student_t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">upper_p</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">stdunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="p">)</span>
        <span class="n">lower</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">student_t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">lower_p</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">stdunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_welchsat_dof</span><span class="p">(</span><span class="n">nominal</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">covdofs</span><span class="p">,</span> <span class="n">deg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the Welchsat equation.</span>

<span class="sd">        https://www.itl.nist.gov/div898/software/dataplot/refman2/auxillar/welchsat.htm</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># individual uncertainties</span>
        <span class="k">if</span> <span class="n">deg</span> <span class="ow">or</span> <span class="n">rad</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">_angle_diff</span><span class="p">(</span><span class="n">cov</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="o">...</span><span class="p">],</span> <span class="n">cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">deg</span><span class="o">=</span><span class="n">deg</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">cov</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="o">...</span><span class="p">]</span> <span class="o">-</span> <span class="n">cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
        <span class="n">covunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;umech_id&#39;</span><span class="p">))</span>

        <span class="n">num</span> <span class="o">=</span> <span class="n">covunc</span><span class="o">**</span><span class="mi">4</span>
        <span class="n">den</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">**</span><span class="mi">4</span> <span class="o">/</span> <span class="n">covdofs</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;umech_id&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span>

<div class="viewcode-block" id="RMEMeas.dof">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.dof">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the dof of of the RMEMeas object&#39;s covariance data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            degrees of freedom of standard uncertainty from linear sensitivity.</span>
<span class="sd">        float</span>
<span class="sd">            degrees of freedom of standard uncertainty from monte-carlo</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># stdunc</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_combine_mechanisms</span><span class="p">(</span><span class="n">deg</span> <span class="o">=</span> <span class="n">deg</span><span class="p">,</span> <span class="n">rad</span> <span class="o">=</span> <span class="n">rad</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">deg</span> <span class="ow">and</span> <span class="n">rad</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;pick deg or rad&#39;</span><span class="p">)</span>
        <span class="n">dof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_welchsat_dof</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">nom</span><span class="p">,</span>
                                 <span class="n">temp</span><span class="o">.</span><span class="n">cov</span><span class="p">,</span>
                                 <span class="n">temp</span><span class="o">.</span><span class="n">covdofs</span><span class="p">,</span>
                                 <span class="n">deg</span><span class="o">=</span><span class="n">deg</span><span class="p">,</span>
                                 <span class="n">rad</span><span class="o">=</span><span class="n">rad</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dof</span></div>


<div class="viewcode-block" id="RMEMeas.stdunc">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.stdunc">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">stdunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">deg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the standard uncertainty with expansion factor k.</span>

<span class="sd">        Supports uncertainties on angles via the deg/rad key word arguments.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        k : float, optional</span>
<span class="sd">            Expansion factor. The default is 1.</span>
<span class="sd">        deg: bool, optional</span>
<span class="sd">            If true, treats the values as angles and finds the minimum</span>
<span class="sd">            distance between the perturbed and un-perturbed data sets in</span>
<span class="sd">            degrees. The default is False</span>
<span class="sd">        rad: bool, optional</span>
<span class="sd">            If true, treats the values as angles and finds the minimum</span>
<span class="sd">            distance between the perturbed and un-perturbed data sets in</span>
<span class="sd">            radians. The default is False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        covunc : xr.DataArray</span>
<span class="sd">            xr.DataArray of std unc from covariance data.</span>
<span class="sd">        mcunc : xr.DataArray</span>
<span class="sd">            standard uncertainty of montecarlo data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">deg</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rad</span><span class="p">:</span>
                <span class="n">covunc</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;umech_id&#39;</span><span class="p">))</span><span class="o">**</span><span class="mf">.5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">deg</span> <span class="ow">and</span> <span class="n">rad</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Either degrees or radians. Not both&#39;</span><span class="p">)</span>
                <span class="c1"># at this point if degrees is false, rad is true, and vice versa.</span>
                <span class="n">covunc</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(((</span><span class="n">_angle_diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">deg</span><span class="o">=</span><span class="n">deg</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;umech_id&#39;</span><span class="p">))</span><span class="o">**</span><span class="mf">.5</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">covunc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mcunc</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;umech_id&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">mcunc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">_uncoutput</span><span class="p">(</span><span class="n">covunc</span><span class="p">,</span> <span class="n">mcunc</span><span class="p">)</span></div>


<div class="viewcode-block" id="RMEMeas.uncbounds">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.uncbounds">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">uncbounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">deg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get uncertainty bounds (nominal + k*stdunc).</span>

<span class="sd">        Supports uncertainties on angles via the deg/rad key word arguments.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        k : float, optional</span>
<span class="sd">            Expansion factor. The default is 1.</span>
<span class="sd">        deg: bool, optional</span>
<span class="sd">            If true, treats the values as angles and finds the minimum</span>
<span class="sd">            distance between the perturbed and un-perturbed data sets in</span>
<span class="sd">            degrees. The default is False</span>
<span class="sd">        rad: bool, optional</span>
<span class="sd">            If true, treats the values as angles and finds the minimum</span>
<span class="sd">            distance between the perturbed and un-perturbed data sets in</span>
<span class="sd">            radians. The default is False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xr.DataArray</span>
<span class="sd">            Uncertainty bounds from cov data.</span>
<span class="sd">        xr.DataArray</span>
<span class="sd">            Uncertainty bounds from montecarlo data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nom</span>
        <span class="n">ucov</span><span class="p">,</span> <span class="n">umc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdunc</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="n">deg</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="n">rad</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ucov</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">covout</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">covout</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="n">ucov</span>
        <span class="k">if</span> <span class="n">umc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mcout</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mcout</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="n">umc</span>
        <span class="k">return</span> <span class="n">_uncoutput</span><span class="p">(</span><span class="n">covout</span><span class="p">,</span> <span class="n">mcout</span><span class="p">)</span></div>


<div class="viewcode-block" id="RMEMeas.assign_categories">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.assign_categories">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">assign_categories</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">mechanisms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
            <span class="n">categories</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
            <span class="n">designation</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign categories to mechanisms.</span>

<span class="sd">        Mechanisms, categories, and designation should all be the same shape.</span>

<span class="sd">        categories and designation correspond to key,</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mechanisms : list[str]</span>
<span class="sd">            1-d List of mechanisms to be assigned a category</span>
<span class="sd">        categories : list[str]</span>
<span class="sd">            1-d list of categories being assigned. Can be new categories that don&#39;t</span>
<span class="sd">            already exist. Index corresponds to index of mechanisms.</span>
<span class="sd">        designation: list[str]</span>
<span class="sd">            1-d list of designation to assign each mechanism. Index corresponds</span>
<span class="sd">            to index of mechanisms.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_empty_categories</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mechanisms</span><span class="p">,</span> <span class="n">categories</span><span class="p">,</span> <span class="n">designation</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span></div>


<div class="viewcode-block" id="RMEMeas.assign_categories_to_all">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.assign_categories_to_all">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">assign_categories_to_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">categories</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign categories to all the linear uncertainty mechanisms.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **categories : list[str]</span>
<span class="sd">            Keyword argument pairs of category names : designation to assign</span>
<span class="sd">            to all linear uncertainty mechanisms in a variable.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plocs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">umech_id</span>
        <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">des</span> <span class="ow">in</span> <span class="n">categories</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="n">cat</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">plocs</span><span class="p">)</span>
            <span class="n">designations</span> <span class="o">=</span> <span class="p">[</span><span class="n">des</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">plocs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assign_categories</span><span class="p">(</span><span class="n">plocs</span><span class="p">,</span> <span class="n">categories</span><span class="p">,</span> <span class="n">designations</span><span class="p">)</span></div>


<div class="viewcode-block" id="RMEMeas.create_empty_categories">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.create_empty_categories">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_empty_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">categories</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add empty categories to the covcats array.</span>

<span class="sd">        If an element in categories already exists, it is ignored and not added.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        category : list[str]</span>
<span class="sd">            List of categories to create. If they already exist, they are not</span>
<span class="sd">            added.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="n">categories</span><span class="p">]</span>
        <span class="n">categories</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">categories</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">categories</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># add extra column for any new categories</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">empty_col</span><span class="p">(</span><span class="n">c</span><span class="p">):</span> <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">c</span><span class="p">]})</span>
            <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">empty_col</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">categories</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">categories</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">new_cols</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">new_cols</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;categories&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="p">,</span> <span class="n">new_cols</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;categories&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="RMEMeas.group_combine_mechanisms">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.group_combine_mechanisms">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">group_combine_mechanisms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;RMEMeas&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Group linear uncertainty mechanism originating from the same combine call.</span>

<span class="sd">        Preserves degrees of freedom does NOT preserve categorical information, used</span>
<span class="sd">        by the self.dof() function prior to running the welch-stat equation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        RMEMeas:</span>
<span class="sd">            New RMEMeas object with the linear uncertainty mechanisms originating</span>
<span class="sd">            from the same combine call (Type A Analysis) grouped together.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">sum_reexpand</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">nominal</span><span class="p">,</span> <span class="n">deg</span><span class="p">,</span> <span class="n">rad</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">deg</span> <span class="ow">or</span> <span class="n">rad</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">deg</span><span class="p">:</span>
                    <span class="n">const</span> <span class="o">=</span> <span class="mi">180</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">const</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="p">(((</span><span class="n">x</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">nominal</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="n">const</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">const</span><span class="p">)</span> <span class="o">-</span> <span class="n">const</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">nominal</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mf">.5</span> <span class="o">+</span> <span class="n">nominal</span><span class="o">.</span><span class="n">values</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">out</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="n">new</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nominal&#39;</span><span class="p">])]</span>
        <span class="n">nominal</span> <span class="o">=</span> <span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">category</span> <span class="o">=</span> <span class="s1">&#39;combine_id&#39;</span>

        <span class="c1"># do stuff</span>
        <span class="n">covcats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">covcats</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span>
        <span class="n">covcats</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Uncategorized&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">groupings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">covcats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">category</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">groupings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">groups</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">covcats</span><span class="o">.</span><span class="n">umech_id</span><span class="p">[</span><span class="n">covcats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">category</span><span class="p">]</span> <span class="o">==</span> <span class="n">g</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groupings</span><span class="p">}</span>

        <span class="n">newdofs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">([],</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;umech_id&#39;</span><span class="p">),</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="p">[]})</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">unused_locs</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Uncategorized&#39;</span><span class="p">)</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">groupings</span> <span class="o">==</span> <span class="s1">&#39;Uncategorized&#39;</span>
            <span class="n">groupings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">groupings</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">groups</span><span class="p">:</span>
                <span class="n">unused_locs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unused_locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">umech_id</span>

        <span class="c1"># calculate dofs</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groupings</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_reexpand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="n">groups</span><span class="p">[</span><span class="n">g</span><span class="p">]),</span> <span class="n">g</span><span class="p">,</span> <span class="n">nominal</span><span class="p">,</span> <span class="n">deg</span> <span class="o">=</span> <span class="n">deg</span><span class="p">,</span> <span class="n">rad</span> <span class="o">=</span> <span class="n">rad</span><span class="p">))</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">groups</span><span class="p">[</span><span class="n">g</span><span class="p">][</span><span class="mi">0</span><span class="p">]]]</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">g</span><span class="p">]})</span>
            <span class="n">newdofs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">newdofs</span><span class="p">,</span> <span class="n">temp</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;umech_id&#39;</span><span class="p">)</span>

        <span class="c1"># else, get the unused mechanisms, and copy their covariance categories</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unused_locs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="n">unused_locs</span><span class="p">))</span>
            <span class="n">newdofs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">newdofs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">unused_locs</span><span class="p">]),</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;umech_id&#39;</span><span class="p">)</span>

        <span class="c1"># concatenate things</span>
        <span class="n">new_cov</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="s1">&#39;umech_id&#39;</span><span class="p">)</span>
        <span class="n">newdofs</span> <span class="o">=</span> <span class="n">newdofs</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="n">new_cov</span><span class="o">.</span><span class="n">umech_id</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_mc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_mc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">RMEMeas</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                      <span class="n">cov</span><span class="o">=</span><span class="n">new_cov</span><span class="p">,</span>
                      <span class="n">mc</span><span class="o">=</span><span class="n">new_mc</span><span class="p">,</span>
                      <span class="n">covdofs</span><span class="o">=</span><span class="n">newdofs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="RMEMeas.categorize_by">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.categorize_by">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">categorize_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                      <span class="n">combine_uncategorized</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                      <span class="n">uncategorized_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;uncategorized&#39;</span><span class="p">,</span>
                      <span class="n">deg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">rad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;RMEMeas&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Group linear uncertainty mechanisms into categories.</span>

<span class="sd">        Mechanisms sharing a common category will be combined quadratically</span>
<span class="sd">        into a single mechanism. For example, if the &#39;Type&#39; category is</span>
<span class="sd">        selected, all the mechanisms with the &#39;Type&#39; = &#39;A&#39; designation in</span>
<span class="sd">        the covcats attribute will be quadratically combined.</span>

<span class="sd">        This function does NOT preserve the DOF&#39;s or the category information</span>
<span class="sd">        of the uncertainty mechanisms after categorization, and is recommended</span>
<span class="sd">        to be used for debugging and presentation purposes only. It is NOT</span>
<span class="sd">        recommended for categorized RMEMeas objects to be saved.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        category : str</span>
<span class="sd">            String identifying the category of uncertainty mechanism.</span>
<span class="sd">        combine_uncategorized: bool,</span>
<span class="sd">            If True, mechanisms that do not contain &#39;category&#39; will all be</span>
<span class="sd">            combined into a single mechanism called uncategorized_name.</span>
<span class="sd">        uncategorized_name:str,</span>
<span class="sd">            String to call all uncategorized mechanisms IF they are being</span>
<span class="sd">            combined. The default is &#39;uncategorized&#39;.</span>
<span class="sd">        deg: bool,</span>
<span class="sd">            If true, calculates minimum angle differences for uncertainties</span>
<span class="sd">            as degrees.</span>
<span class="sd">        rad: bool,</span>
<span class="sd">            If true, calculates minimum angle differences for uncertainties</span>
<span class="sd">            as radians.</span>
<span class="sd">        verbose : bool, optional</span>
<span class="sd">            Print information about grouping. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : RMEMeas</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">rad</span><span class="p">,</span> <span class="n">deg</span><span class="p">])</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">sum_reexpand</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">nominal</span><span class="p">,</span> <span class="n">deg</span><span class="p">,</span> <span class="n">rad</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">deg</span> <span class="ow">or</span> <span class="n">rad</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">deg</span><span class="p">:</span>
                    <span class="n">const</span> <span class="o">=</span> <span class="mi">180</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">const</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="p">(((</span><span class="n">x</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">nominal</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="n">const</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">const</span><span class="p">)</span> <span class="o">-</span> <span class="n">const</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">nominal</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mf">.5</span> <span class="o">+</span> <span class="n">nominal</span><span class="o">.</span><span class="n">values</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">out</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="n">new</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nominal&#39;</span><span class="p">])]</span>
        <span class="n">nominal</span> <span class="o">=</span> <span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># do stuff</span>
        <span class="n">covcats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">covcats</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span>
        <span class="n">covcats</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Uncategorized&#39;</span>

        <span class="n">groupings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">covcats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">category</span><span class="p">])</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">covcats</span><span class="o">.</span><span class="n">umech_id</span><span class="p">[</span><span class="n">covcats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">category</span><span class="p">]</span> <span class="o">==</span> <span class="n">g</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groupings</span><span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">unused_locs</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Uncategorized&#39;</span><span class="p">)</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">groupings</span> <span class="o">==</span> <span class="s1">&#39;Uncategorized&#39;</span>
            <span class="n">groupings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">groupings</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">unused_locs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groupings</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_reexpand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="n">groups</span><span class="p">[</span><span class="n">g</span><span class="p">]),</span> <span class="n">g</span><span class="p">,</span> <span class="n">nominal</span><span class="p">,</span> <span class="n">deg</span><span class="p">,</span> <span class="n">rad</span><span class="p">))</span>

        <span class="c1"># if combining, pool them into a single mecanism</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unused_locs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">combine_uncategorized</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_reexpand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="n">unused_locs</span><span class="p">),</span> <span class="n">uncategorized_name</span><span class="p">,</span> <span class="n">nominal</span><span class="p">,</span> <span class="n">deg</span><span class="p">,</span> <span class="n">rad</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;un mapped umech id being added to ungrouped.&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">unused_locs</span><span class="p">)</span>

        <span class="c1"># else, get the unused mechanisms, and copy their covariance categories</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">unused_locs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">combine_uncategorized</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="n">unused_locs</span><span class="p">))</span>

        <span class="c1"># concatenate things</span>
        <span class="n">new_cov</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="s1">&#39;umech_id&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_mc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_mc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">RMEMeas</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="n">new_cov</span><span class="p">,</span> <span class="n">mc</span><span class="o">=</span><span class="n">new_mc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="RMEMeas.get_unique_categories">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.get_unique_categories">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_unique_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of unique categories.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>


<div class="viewcode-block" id="RMEMeas.print_categories">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.print_categories">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">print_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print out the unique categories.&quot;&quot;&quot;</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unique_categories</span><span class="p">()</span>
        <span class="n">title</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; cov categories&#39;</span><span class="p">)</span>
        <span class="n">maxl</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cats</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cats</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">maxl</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">__array_ufunc__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ufunc</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">propagate</span> <span class="o">=</span> <span class="n">propagators</span><span class="o">.</span><span class="n">RMEProp</span><span class="o">.</span><span class="n">_active</span><span class="o">.</span><span class="n">propagate</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">propagate</span><span class="p">(</span><span class="n">ufunc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new</span><span class="p">(</span><span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="n">propagate</span> <span class="o">=</span> <span class="n">propagators</span><span class="o">.</span><span class="n">RMEProp</span><span class="o">.</span><span class="n">_active</span><span class="o">.</span><span class="n">propagate</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">o</span>
        <span class="n">fnc</span> <span class="o">=</span> <span class="n">propagate</span><span class="p">(</span><span class="fm">__add__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fnc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="n">propagate</span> <span class="o">=</span> <span class="n">propagators</span><span class="o">.</span><span class="n">RMEProp</span><span class="o">.</span><span class="n">_active</span><span class="o">.</span><span class="n">propagate</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">o</span>
        <span class="n">fnc</span> <span class="o">=</span> <span class="n">propagate</span><span class="p">(</span><span class="fm">__radd__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fnc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="n">propagate</span> <span class="o">=</span> <span class="n">propagators</span><span class="o">.</span><span class="n">RMEProp</span><span class="o">.</span><span class="n">_active</span><span class="o">.</span><span class="n">propagate</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">o</span>
        <span class="n">fnc</span> <span class="o">=</span> <span class="n">propagate</span><span class="p">(</span><span class="fm">__mul__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fnc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="n">propagate</span> <span class="o">=</span> <span class="n">propagators</span><span class="o">.</span><span class="n">RMEProp</span><span class="o">.</span><span class="n">_active</span><span class="o">.</span><span class="n">propagate</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">o</span>
        <span class="n">fnc</span> <span class="o">=</span> <span class="n">propagate</span><span class="p">(</span><span class="fm">__rmul__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fnc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="n">propagate</span> <span class="o">=</span> <span class="n">propagators</span><span class="o">.</span><span class="n">RMEProp</span><span class="o">.</span><span class="n">_active</span><span class="o">.</span><span class="n">propagate</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">-</span> <span class="n">o</span>
        <span class="n">fnc</span> <span class="o">=</span> <span class="n">propagate</span><span class="p">(</span><span class="fm">__sub__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fnc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="n">propagate</span> <span class="o">=</span> <span class="n">propagators</span><span class="o">.</span><span class="n">RMEProp</span><span class="o">.</span><span class="n">_active</span><span class="o">.</span><span class="n">propagate</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">o</span> <span class="o">-</span> <span class="bp">self</span>
        <span class="n">fnc</span> <span class="o">=</span> <span class="n">propagate</span><span class="p">(</span><span class="fm">__rsub__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fnc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="n">propagate</span> <span class="o">=</span> <span class="n">propagators</span><span class="o">.</span><span class="n">RMEProp</span><span class="o">.</span><span class="n">_active</span><span class="o">.</span><span class="n">propagate</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">**</span><span class="n">o</span>
        <span class="n">fnc</span> <span class="o">=</span> <span class="n">propagate</span><span class="p">(</span><span class="fm">__pow__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fnc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="n">propagate</span> <span class="o">=</span> <span class="n">propagators</span><span class="o">.</span><span class="n">RMEProp</span><span class="o">.</span><span class="n">_active</span><span class="o">.</span><span class="n">propagate</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">/</span> <span class="n">o</span>
        <span class="n">fnc</span> <span class="o">=</span> <span class="n">propagate</span><span class="p">(</span><span class="fm">__truediv__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fnc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="n">propagate</span> <span class="o">=</span> <span class="n">propagators</span><span class="o">.</span><span class="n">RMEProp</span><span class="o">.</span><span class="n">_active</span><span class="o">.</span><span class="n">propagate</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">o</span> <span class="o">/</span> <span class="bp">self</span>
        <span class="n">fnc</span> <span class="o">=</span> <span class="n">propagate</span><span class="p">(</span><span class="fm">__rtruediv__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fnc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>

<div class="viewcode-block" id="RMEMeas.interp">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.interp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">coords</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span>
               <span class="n">assume_sorted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
               <span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">coords_kwargs</span>
               <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interpolate RMEMeas object.</span>

<span class="sd">        See xarray interp documentation for more details.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coords : dict, optional</span>
<span class="sd">            Mapping from dimension names to the new coordinates.</span>
<span class="sd">            New coordinate can be a scalar, array-like or DataArray.</span>
<span class="sd">            If DataArrays are passed as new coordinates, their dimensions are</span>
<span class="sd">            used for the broadcasting. Missing values are skipped.</span>
<span class="sd">            The default is None.</span>
<span class="sd">        method : str, optional</span>
<span class="sd">            {&quot;linear&quot;, &quot;nearest&quot;, &quot;zero&quot;, &quot;slinear&quot;, &quot;quadratic&quot;, &quot;cubic&quot;,</span>
<span class="sd">             &quot;quintic&quot;, &quot;polynomial&quot;, &quot;pchip&quot;, &quot;barycentric&quot;, &quot;krogh&quot;, &quot;akima&quot;,</span>
<span class="sd">             &quot;makima&quot;})  Interpolation method. The default is &#39;linear&#39;.</span>
<span class="sd">        assume_sorted : bool, optional</span>
<span class="sd">            If False, values of x can be in any order and they are sorted</span>
<span class="sd">            first. If True, x has to be an array of monotonically increasing</span>
<span class="sd">            values. The default is False.</span>
<span class="sd">        kwargs : dict, optional</span>
<span class="sd">            Additional keyword arguments passed to scipys interpolator.</span>
<span class="sd">            Valid options and their behavior depend whether interp1d or</span>
<span class="sd">            interpn is used.. The default is None.</span>
<span class="sd">        **coords_kwargs : dict like</span>
<span class="sd">            The keyword arguments form of coords. One of coords or</span>
<span class="sd">            coords_kwargs must be provided..</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newcov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
            <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">assume_sorted</span><span class="o">=</span><span class="n">assume_sorted</span><span class="p">,</span>
            <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">coords_kwargs</span>
        <span class="p">)</span>

        <span class="n">newmc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">newmc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
                <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                <span class="n">assume_sorted</span><span class="o">=</span><span class="n">assume_sorted</span><span class="p">,</span>
                <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="o">**</span><span class="n">coords_kwargs</span>
            <span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">RMEMeas</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">newcov</span><span class="p">,</span>
            <span class="n">newmc</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="RMEMeas.usel">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.usel">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">usel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">umech_id</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">mcsamples</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
             <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;RMEMeas&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a view into specific uncertainty mechanisms or Monte Carlo samples.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        umech_id : iter[str], optional</span>
<span class="sd">            Linear uncertainty mechanisms to look at. The default is None.</span>
<span class="sd">        mcsamples : iter[int], optional</span>
<span class="sd">            Monte Carlo samples to look at. The default is None.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If &#39;nominal&#39; is passed to umech_id, or 0 is passed to</span>
<span class="sd">            the mcsamples. Those represent the nominal values and are</span>
<span class="sd">            always included by default, since an uncertainty object should</span>
<span class="sd">            always have a nominal value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &#39;RMEMeas&#39;</span>
<span class="sd">            View into RMEMeas object with only the selected linear uncertainty</span>
<span class="sd">            mechanisms and Monte Carlo samples.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span>
        <span class="n">covcats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span>
        <span class="n">covdofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span>
        <span class="n">umechs</span> <span class="o">=</span> <span class="n">umech_id</span>
        <span class="c1"># if its just a string, covdofs will not have the right number of</span>
        <span class="c1"># dimensions when it gets indexed into.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">umechs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">umechs</span> <span class="o">=</span> <span class="p">[</span><span class="n">umechs</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">umechs</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">umechs</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;nominal&#39;</span> <span class="ow">in</span> <span class="n">umechs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;nominal always included, dont pass it.&#39;</span><span class="p">)</span>
            <span class="n">keep1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">umechs</span><span class="p">)}</span>
            <span class="n">lin2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;nominal&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">umechs</span><span class="p">))</span>
            <span class="n">keep2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="n">lin2</span><span class="p">}</span>
            <span class="n">cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">keep2</span><span class="p">)</span>
            <span class="n">covcats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">keep1</span><span class="p">)</span>
            <span class="n">covdofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">keep1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">umechs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;umech_id not recognized, must be iterable&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mcsamples</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mcsamples</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">mcsamples</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;0 index always included (it is the nominal), dont pass it.&#39;</span><span class="p">)</span>
            <span class="n">keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mcsamples</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="n">keep</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mcsamples</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;mcsamples not recognized, must be iterable&#39;</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">RMEMeas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="n">covdofs</span><span class="p">,</span> <span class="n">covcats</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slices</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;RMEMeas&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get view into underlying data with integer based indexing.</span>

<span class="sd">        Ignores the umech_id dimension, it cannot be indexed into</span>
<span class="sd">        with this function.Index into array assuming the umech_id</span>
<span class="sd">        dimensions doesn&#39;t exist in cov (i.e. as if indexing into only the</span>
<span class="sd">        nominal)</span>

<span class="sd">        Generates a view on the underlying cov,mc, covcats</span>
<span class="sd">        and covdofs array. Use .copy() to create an unconnected version.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slices</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">slices</span> <span class="o">=</span> <span class="p">(</span><span class="n">slices</span><span class="p">,)</span>

        <span class="n">cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">[:,</span> <span class="o">*</span><span class="n">slices</span><span class="p">]</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">[:,</span> <span class="o">*</span><span class="n">slices</span><span class="p">]</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">RMEMeas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">loc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get view into underlying data with label based indexing.</span>

<span class="sd">        Ignores the umech_id dimension, it cannot be indexed into</span>
<span class="sd">        with this function.Index into array assuming the umech_id</span>
<span class="sd">        dimensions doesn&#39;t exist in cov (i.e. as if indexing into only the</span>
<span class="sd">        nominal)</span>

<span class="sd">        Generates a view on the underlying cov,mc, covcats</span>
<span class="sd">        and covdofs array. Use .copy() to create an unconnected version.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_RMELocIndexer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="RMEMeas.sel">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.sel">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">indexers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">indexers_kwargs</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;RMEMeas&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get view into underlying data with label based selection.</span>

<span class="sd">        Ignores the umech_id dimension, it cannot be indexed into</span>
<span class="sd">        with this function.Index into array assuming the umech_id</span>
<span class="sd">        dimensions doesn&#39;t exist in cov (i.e. as if indexing into only the</span>
<span class="sd">        nominal)</span>

<span class="sd">        Generates a view on the underlying cov,mc, covcats</span>
<span class="sd">        and covdofs array. Use .copy() to create an unconnected version.</span>

<span class="sd">        See documentation on DataArray.sel in the xarray package for details.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indexers : TYPE, optional</span>
<span class="sd">            A dict with keys matching dimensions and values given by scalars,</span>
<span class="sd">            slices or arrays of tick labels. For dimensions with multi-index,</span>
<span class="sd">            the indexer may also be a dict-like object with keys matching index</span>
<span class="sd">            level names.</span>
<span class="sd">            umech_id can&#39;t be provided.</span>
<span class="sd">        method : str, optional</span>
<span class="sd">            Method to use for inexact matches:</span>
<span class="sd">            * None (default): only exact matches</span>
<span class="sd">            * pad / ffill: propagate last valid index value forward</span>
<span class="sd">            * backfill / bfill: propagate next valid index value backward</span>
<span class="sd">            * nearest: use nearest valid index value</span>
<span class="sd">            The default is None.</span>
<span class="sd">        tolerance : float, optional</span>
<span class="sd">            Maximum distance between original and new labels for inexact</span>
<span class="sd">            matches. The values of the index at the matching locations must</span>
<span class="sd">            satisfy the equation abs(index[indexer] - target) &lt;= tolerance.</span>
<span class="sd">        **indexers_kwargs : dict</span>
<span class="sd">            The keyword arguments form of indexers.</span>
<span class="sd">            One of indexers or indexers_kwargs must be provided.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : RMEMeas</span>
<span class="sd">            View into indexed RMEMeas object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">forbid</span> <span class="o">=</span> <span class="s1">&#39;umech_id&#39;</span>
        <span class="k">if</span> <span class="n">indexers_kwargs</span> <span class="ow">and</span> <span class="n">forbid</span> <span class="ow">in</span> <span class="n">indexers_kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39; Cannot index into umech_id here&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">indexers</span> <span class="ow">and</span> <span class="n">forbid</span> <span class="ow">in</span> <span class="n">indexers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39; Cannot index into umech_id here&#39;</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">indexers</span><span class="o">=</span><span class="n">indexers</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span>
        <span class="p">)</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">indexers_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="n">mc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">indexers_kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">RMEMeas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="RMEMeas.isel">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.isel">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">isel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">indexers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">drop</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">missing_dims</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span>
             <span class="o">**</span><span class="n">indexers_kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;RMEMeas&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get view into underlying data with integer based selection.</span>

<span class="sd">        Ignores the umech_id dimension, it cannot be indexed into</span>
<span class="sd">        with this function.Index into array assuming the umech_id</span>
<span class="sd">        dimensions doesn&#39;t exist in cov (i.e. as if indexing into only the</span>
<span class="sd">        nominal)</span>

<span class="sd">        Generates a view on the underlying cov,mc, covcats</span>
<span class="sd">        and covdofs array. Use .copy() to create an unconnected version.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indexers : dict, optional</span>
<span class="sd">            A dict with keys matching dimensions and values given by integers,</span>
<span class="sd">            slice objects or arrays. indexer can be a integer, slice,</span>
<span class="sd">            array-like or DataArray. If DataArrays are passed as indexers,</span>
<span class="sd">            xarray-style indexing will be carried out.One of indexers or</span>
<span class="sd">            indexers_kwargs must be provided.. The default is None.</span>
<span class="sd">        drop : bool, optional</span>
<span class="sd">            drop coordinates variables indexed by integers instead of making</span>
<span class="sd">            them scalar. The default is False.</span>
<span class="sd">        missing_dims : str, optional</span>
<span class="sd">           What to do if dimensions that should be selected from are not</span>
<span class="sd">           present in the DataArray: - raise: raise an exception - warn:</span>
<span class="sd">           raise a warning, and ignore the missing dimensions - ignore:</span>
<span class="sd">           ignore the missing dimensions. The default is &#39;raise&#39;.</span>
<span class="sd">        **indexers_kwargs : TYPE</span>
<span class="sd">           The keyword arguments form of indexers..</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : RMEMeas</span>
<span class="sd">            View into indexed RMEMeas object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">forbid</span> <span class="o">=</span> <span class="s1">&#39;umech_id&#39;</span>
        <span class="k">if</span> <span class="n">indexers_kwargs</span> <span class="ow">and</span> <span class="n">forbid</span> <span class="ow">in</span> <span class="n">indexers_kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39; Cannot index into umech_id here&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">indexers</span> <span class="ow">and</span> <span class="n">forbid</span> <span class="ow">in</span> <span class="n">indexers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39; Cannot index into umech_id here&#39;</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">indexers</span><span class="o">=</span><span class="n">indexers</span><span class="p">,</span>
            <span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">,</span>
            <span class="n">missing_dims</span><span class="o">=</span><span class="n">missing_dims</span>
        <span class="p">)</span>

        <span class="n">cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">indexers_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">indexers_kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">RMEMeas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="RMEMeas.polyfit">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.polyfit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">polyfit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">deg</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">apply_cov</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;RMEMeas&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a polynominal fit along dim.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dim : str</span>
<span class="sd">            Name of dimension to fit along.</span>
<span class="sd">        deg : int</span>
<span class="sd">            Degree of fit</span>
<span class="sd">        aoo</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        RMEMeas</span>
<span class="sd">            Coefficients of data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="n">fit</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">deg</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">coeffs</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">polyfit_coefficients</span>
            <span class="n">coeffs</span> <span class="o">=</span> <span class="n">coeffs</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="s1">&#39;degree&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">coeffs</span>

        <span class="n">cov</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">RMEMeas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span></div>


<div class="viewcode-block" id="RMEMeas.polyval">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.polyval">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">polyval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">degree_dim</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;RMEMeas&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate a polynomial fit along coord.</span>

<span class="sd">        Assumes self is a measurement of fit-parameters, with the</span>
<span class="sd">        dimension of polynomial fits along degree_dim.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coord : xr.DataArray</span>
<span class="sd">            Coordinate to fit along.</span>
<span class="sd">        degree_dim : str</span>
<span class="sd">            Polynomial degree dimension.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        RMEMeas</span>
<span class="sd">            Coefficients of data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">covout</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">,</span> <span class="n">degree_dim</span><span class="o">=</span><span class="n">degree_dim</span><span class="p">)</span>
        <span class="n">covout</span> <span class="o">=</span> <span class="n">covout</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="o">*</span><span class="n">coord</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">,</span> <span class="n">degree_dim</span><span class="o">=</span><span class="n">degree_dim</span><span class="p">)</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="o">*</span><span class="n">coord</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">RMEMeas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">covout</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span></div>


<div class="viewcode-block" id="RMEMeas.curvefit">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.curvefit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">curvefit</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">coords</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">],</span>
            <span class="n">func</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
            <span class="n">reduce_dims</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Iterable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">skipna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">p0</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">bounds</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">param_names</span><span class="p">:</span> <span class="n">Sequence</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simple binding to curvefit on xarray.</span>

<span class="sd">        The nominal value is solved for first, than used as an initial guess for the</span>
<span class="sd">        perturbed datasets.</span>

<span class="sd">        See https://docs.xarray.dev/en/stable/generated/xarray.DataArray.curvefit.html for</span>
<span class="sd">        more details.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coords : str | xr.DataArray | Sequence[str] | Sequence[xr.DataArray], DataArray</span>
<span class="sd">            Independent coordinate(s) over which to perform the curve fitting.</span>
<span class="sd">            Must share at least one dimension with the calling object.</span>
<span class="sd">            When fitting multi-dimensional functions,</span>
<span class="sd">            supply coords as a sequence in the same order as arguments in func.</span>
<span class="sd">            To fit along existing dimensions of the calling object, coords can also be specified as a str or sequence of strs.</span>
<span class="sd">        func : callable</span>
<span class="sd">           User specified function in the form f(x, *params) which returns a numpy array of length len(x).</span>
<span class="sd">           Params are the fittable parameters which are optimized by scipy curve_fit. </span>
<span class="sd">           x can also be specified as a sequence containing multiple coordinates, e.g. f((x0, x1), *params).</span>
<span class="sd">        reduce_dims: str | Iterable | None, optional</span>
<span class="sd">            Additional dimension(s) over which to aggregate while fitting. For example, calling ds.curvefit(coords=time, reduce_dims=[lat, lon], )</span>
<span class="sd">            will aggregate all lat and lon points and fit the specified function along the time dimension.</span>
<span class="sd">        skipna : bool, optional</span>
<span class="sd">            Whether to skip missing values when fitting. Default is True.</span>
<span class="sd">        p0 : dict, optional</span>
<span class="sd">            Optional dictionary of parameter names to initial guesses passed to the curve_fit p0 arg.</span>
<span class="sd">            If the values are DataArrays, they will be appropriately broadcast to the coordinates of the array.</span>
<span class="sd">            If none or only some parameters are passed, the rest will be assigned initial values following the default</span>
<span class="sd">            scipy behavior</span>
<span class="sd">        bounds : dict, optional</span>
<span class="sd">            Optional dictionary of parameter names to tuples of bounding values passed to the curve_fit bounds arg.</span>
<span class="sd">            If any of the bounds are DataArrays, they will be appropriately broadcast to the coordinates of the array.</span>
<span class="sd">            If none or only some parameters are passed, the rest will be unbounded following the default scipy behavior.</span>
<span class="sd">        param_names : Sequence | None, optional</span>
<span class="sd">            Sequence of names for the fittable parameters of func. If not supplied, this will be automatically determined</span>
<span class="sd">            by arguments of func. param_names should be manually supplied when fitting a function that takes a</span>
<span class="sd">            variable number of parameters.</span>
<span class="sd">        errors : str, optional</span>
<span class="sd">            If raise, any errors from the scipy.optimize_curve_fit optimization will raise an exception.</span>
<span class="sd">            If ignore, the coefficients and covariances for the coordinates where the fitting failed will be NaN.</span>
<span class="sd">        **kwargs : optional</span>
<span class="sd">            Additional keyword arguments passed to scipy curve_fit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># param_names = param_names</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="c1"># fit to the nominal first to generate an initial guess</span>
            <span class="n">coeffs</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">curvefit</span><span class="p">(</span>
                <span class="n">coords</span><span class="p">,</span>
                <span class="n">func</span><span class="p">,</span>
                <span class="n">reduce_dims</span><span class="o">=</span><span class="n">reduce_dims</span><span class="p">,</span>
                <span class="n">skipna</span><span class="o">=</span><span class="n">skipna</span><span class="p">,</span>
                <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">param_names</span> <span class="o">=</span> <span class="n">param_names</span><span class="p">,</span>
                <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">curvefit_coefficients</span>

            <span class="c1"># refit to the rest of the data with an accurate initial guess</span>
            <span class="n">fit_param_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">coeffs</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">newp0</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="n">coeffs</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fit_param_names</span><span class="p">}</span>
            <span class="n">coeffs</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">curvefit</span><span class="p">(</span>
                <span class="n">coords</span><span class="p">,</span>
                <span class="n">func</span><span class="p">,</span>
                <span class="n">reduce_dims</span><span class="o">=</span><span class="n">reduce_dims</span><span class="p">,</span>
                <span class="n">skipna</span><span class="o">=</span><span class="n">skipna</span><span class="p">,</span>
                <span class="n">p0</span><span class="o">=</span><span class="n">newp0</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">param_names</span><span class="o">=</span><span class="n">param_names</span><span class="p">,</span>
                <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">curvefit_coefficients</span>
            <span class="k">return</span> <span class="n">coeffs</span>

        <span class="n">cov</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">)</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RMEMeas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span></div>


<div class="viewcode-block" id="RMEMeas.curveval">
<a class="viewcode-back" href="../../../autoapi/rmellipse/uobjects/index.html#rmellipse.uobjects.RMEMeas.curveval">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">curveval</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">func</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
            <span class="n">coords</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the output of curvefit.</span>

<span class="sd">        Assumes there is a dimension called &#39;param&#39; that coresponds.</span>
<span class="sd">        to the fit coefficients of func. Assumes function is nonlinear</span>
<span class="sd">        and iterates over each function evaluation, which can be slow.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>
<span class="sd">            callable function</span>
<span class="sd">        coords : xr.DataArray</span>
<span class="sd">            coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">eval</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">umech_id</span><span class="p">):</span>
                <span class="n">coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">umech_id</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">arr</span><span class="o">.</span><span class="n">param</span><span class="p">]</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="o">*</span><span class="n">coeffs</span><span class="p">)</span>
                <span class="c1"># preallocate output</span>
                <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">output</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">({</span><span class="s1">&#39;umech_id&#39;</span><span class="p">:</span> <span class="n">arr</span><span class="o">.</span><span class="n">umech_id</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
            <span class="k">return</span> <span class="n">output</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">)</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RMEMeas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covdofs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">covcats</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span></div>
</div>



<span class="c1"># this took me a minute to figure out so leaving it here for when I need it</span>
<span class="k">class</span><span class="w"> </span><span class="nc">_RMELocIndexer</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Index creator class for xarray like indexing on RMEMeas objects.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">other</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slices</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slices</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">slices</span> <span class="o">=</span> <span class="p">(</span><span class="n">slices</span><span class="p">,)</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">cov</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="o">*</span><span class="n">slices</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">mc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="o">*</span><span class="n">slices</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mc</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">RMEMeas</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">cov</span><span class="p">,</span>
            <span class="n">mc</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">covdofs</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">covcats</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span>
</pre></div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../../index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/index.html">rmellipse Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../for_contributors/index.html">For Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a></li>
</ul>

<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
<h3>Versions</h3>
<ul>
  <li><a href="../../../../v0.3.4/index.html">v0.3.4</a></li>
  <li><a href="_rmemeas.html">stable</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Rocky Mountain Ellipse 0.3.5.dev4+ga287edda7 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">rmellipse.uobjects._rmemeas</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, National Institute of Standards and Technology.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.0.
    </div>
  </body>
</html>